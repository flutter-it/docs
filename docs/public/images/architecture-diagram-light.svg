<svg viewBox="0 -20 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Define arrow markers for light mode -->
  <defs>
    <!-- Red arrow for commands/method calls -->
    <marker id="arrow-red-light" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#EF5350" />
    </marker>
    <!-- Green arrow for ValueListenables -->
    <marker id="arrow-green-light" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#66BB6A" />
    </marker>
    <!-- Purple arrow for async calls/streams (right pointing) -->
    <marker id="arrow-purple-end-light" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#AB47BC" />
    </marker>
    <!-- Purple arrow for async calls/streams (left pointing) -->
    <marker id="arrow-purple-start-light" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M9,0 L9,6 L0,3 z" fill="#AB47BC" />
    </marker>
    <!-- Gray arrow (right pointing) -->
    <marker id="arrow-gray-end-light" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#757575" />
    </marker>
    <!-- Gray arrow (left pointing) -->
    <marker id="arrow-gray-start-light" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M9,0 L9,6 L0,3 z" fill="#757575" />
    </marker>
  </defs>

  <!-- Layer Labels -->
  <text x="120" y="15" text-anchor="middle" font-size="20" font-weight="700" fill="#F9A825">UI Layer</text>
  <text x="585" y="15" text-anchor="middle" font-size="20" font-weight="700" fill="#1976D2">Business Logic Layer</text>
  <text x="1050" y="15" text-anchor="middle" font-size="20" font-weight="700" fill="#FF7043">Services Layer</text>

  <!-- Row 1: All centered at y=120 -->

  <!-- Invoice Detail View (center at 120) -->
  <rect x="20" y="45" width="200" height="160" rx="8" fill="#FDD835" stroke="#F9A825" stroke-width="3"/>
  <text x="120" y="110" text-anchor="middle" font-size="22" font-weight="600" fill="#212121">Invoice Detail</text>
  <text x="120" y="140" text-anchor="middle" font-size="22" font-weight="600" fill="#212121">View</text>

  <!-- Invoice Proxy (Hexagon) - centered at y=120 -->
  <path d="M 300,80 L 380,30 L 460,80 L 460,160 L 380,210 L 300,160 Z"
        fill="#00BCD4" stroke="#0097A7" stroke-width="3"/>
  <text x="380" y="112" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Invoice</text>
  <text x="380" y="140" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Proxy</text>

  <!-- Invoice Manager - centered at y=120 -->
  <rect x="600" y="50" width="220" height="140" rx="20" fill="#1976D2" stroke="#1565C0" stroke-width="3"/>
  <text x="710" y="110" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Invoice</text>
  <text x="710" y="140" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Manager</text>

  <!-- Database Service - centered at y=120 -->
  <ellipse cx="1050" cy="120" rx="140" ry="90" fill="#FF7043" stroke="#F4511E" stroke-width="3"/>
  <text x="1050" y="115" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Database</text>
  <text x="1050" y="145" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Service</text>

  <!-- Row 2: All centered at y=340 -->

  <!-- Login View (center at 340) -->
  <rect x="20" y="260" width="200" height="160" rx="8" fill="#FDD835" stroke="#F9A825" stroke-width="3"/>
  <text x="120" y="340" text-anchor="middle" font-size="22" font-weight="600" fill="#212121">Login View</text>

  <!-- User Manager - centered at y=340 -->
  <rect x="600" y="270" width="220" height="140" rx="20" fill="#1976D2" stroke="#1565C0" stroke-width="3"/>
  <text x="710" y="340" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">User Manager</text>

  <!-- Authentication Service - centered at y=340 -->
  <ellipse cx="1050" cy="340" rx="140" ry="90" fill="#FF7043" stroke="#F4511E" stroke-width="3"/>
  <text x="1050" y="335" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Authentication</text>
  <text x="1050" y="365" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Service</text>

  <!-- Row 3: All centered at y=560 -->

  <!-- Map View (center at 560) -->
  <rect x="20" y="480" width="200" height="160" rx="8" fill="#FDD835" stroke="#F9A825" stroke-width="3"/>
  <text x="120" y="565" text-anchor="middle" font-size="22" font-weight="600" fill="#212121">Map View</text>

  <!-- Location Service - centered at y=560 -->
  <ellipse cx="1050" cy="560" rx="140" ry="90" fill="#FF7043" stroke="#F4511E" stroke-width="3"/>
  <text x="1050" y="555" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Location</text>
  <text x="1050" y="585" text-anchor="middle" font-size="22" font-weight="600" fill="#FFFFFF">Service</text>

  <!-- Connections/Arrows -->

  <!-- Invoice Detail View -> Invoice Proxy (red) - with vertical spacing -->
  <line x1="220" y1="110" x2="300" y2="110" stroke="#EF5350" stroke-width="3" marker-end="url(#arrow-red-light)"/>

  <!-- Invoice Proxy -> Invoice Detail View (green) - with vertical spacing -->
  <line x1="300" y1="130" x2="220" y2="130" stroke="#66BB6A" stroke-width="3" marker-end="url(#arrow-green-light)"/>

  <!-- Invoice Proxy <-> Invoice Manager (purple bidirectional) - horizontal at center -->
  <line x1="460" y1="120" x2="600" y2="120" stroke="#AB47BC" stroke-width="3" marker-start="url(#arrow-purple-start-light)" marker-end="url(#arrow-purple-end-light)"/>

  <!-- Invoice Proxy -> User Manager (red diagonal) - from middle of hexagon right-bottom face -->
  <line x1="420" y1="185" x2="600" y2="300" stroke="#EF5350" stroke-width="3" marker-end="url(#arrow-red-light)"/>

  <!-- Invoice Manager <-> User Manager (gray bidirectional with **) -->
  <line x1="710" y1="190" x2="710" y2="270" stroke="#757575" stroke-width="3" marker-start="url(#arrow-gray-start-light)" marker-end="url(#arrow-gray-end-light)"/>
  <text x="740" y="235" font-size="22" font-weight="normal" fill="#616161">**</text>

  <!-- Login View -> User Manager (red) -->
  <line x1="220" y1="330" x2="600" y2="330" stroke="#EF5350" stroke-width="3" marker-end="url(#arrow-red-light)"/>

  <!-- User Manager -> Login View (green) -->
  <line x1="600" y1="350" x2="220" y2="350" stroke="#66BB6A" stroke-width="3" marker-end="url(#arrow-green-light)"/>

  <!-- Invoice Manager <-> Database Service (purple bidirectional) -->
  <line x1="820" y1="120" x2="910" y2="120" stroke="#AB47BC" stroke-width="3" marker-start="url(#arrow-purple-start-light)" marker-end="url(#arrow-purple-end-light)"/>

  <!-- User Manager <-> Authentication Service (purple bidirectional) -->
  <line x1="820" y1="340" x2="910" y2="340" stroke="#AB47BC" stroke-width="3" marker-start="url(#arrow-purple-start-light)" marker-end="url(#arrow-purple-end-light)"/>

  <!-- Map View <-> Location Service (purple bidirectional) -->
  <line x1="220" y1="560" x2="910" y2="560" stroke="#AB47BC" stroke-width="3" marker-start="url(#arrow-purple-start-light)" marker-end="url(#arrow-purple-end-light)"/>

  <!-- Legend at bottom with proper spacing - darker colors for light mode -->
  <g transform="translate(80, 670)">
    <!-- Red arrow -->
    <line x1="0" y1="10" x2="60" y2="10" stroke="#EF5350" stroke-width="3" marker-end="url(#arrow-red-light)"/>
    <text x="75" y="17" font-size="18" font-weight="600" fill="#C62828">Commands or method calls</text>

    <!-- Green arrow - horizontal spacing -->
    <line x1="350" y1="10" x2="410" y2="10" stroke="#66BB6A" stroke-width="3" marker-end="url(#arrow-green-light)"/>
    <text x="425" y="17" font-size="18" font-weight="600" fill="#2E7D32">ValueListenables</text>

    <!-- Purple bidirectional arrow - horizontal spacing -->
    <line x1="620" y1="10" x2="680" y2="10" stroke="#AB47BC" stroke-width="3" marker-start="url(#arrow-purple-start-light)" marker-end="url(#arrow-purple-end-light)"/>
    <text x="695" y="17" font-size="18" font-weight="600" fill="#6A1B9A">(async) function calls or Streams</text>
  </g>

  <!-- Note text with vertical spacing from legend - darker for light mode -->
  <foreignObject x="80" y="700" width="1000" height="60">
    <div xmlns="http://www.w3.org/1999/xhtml" style="font-size: 17px; font-weight: 500; color: #616161; line-height: 1.4;">
      ** Can be (async) function calls or ValueListenables or Commands. But should be limited as much as possible to avoid unnecessary coupling. At some point it might be better to add an Eventbus
    </div>
  </foreignObject>
</svg>
